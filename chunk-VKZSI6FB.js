import{Fa as ae,Ha as pe,I as w,L as k,M as B,N as E,R as ee,S as te,V as C,W as oe,ga as d,k as M,l as T,n as L,na as D,p as N,q as W,ua as F,wa as ie,x,xa as ne}from"./chunk-EY4PQBT6.js";import"./chunk-PT7B6MVV.js";import"./chunk-X3GKO6FF.js";import{$b as h,Ac as U,B as R,Cb as u,Cc as J,Ec as K,Gc as _,Ha as v,Hc as b,Ic as P,Nb as V,Ob as G,P as g,Ub as l,V as j,_ as $,ca as z,ec as n,fc as a,gc as s,ia as r,id as X,jb as p,jd as Y,pc as y,qc as O,sb as H,tb as S,xb as m,yd as Z,zc as Q}from"./chunk-WCLJ7DBJ.js";import"./chunk-JKOY2XUY.js";var f=(()=>{class e{constructor(){this.http=r(Z),this.apiUrl="https://swapi.py4e.com/api/people",this.currentSearch="",this.#e=v(0)}#e;get timer(){return this.#e}findPeopleWithCache(t){return this.compareSearchValue(t),this.data$||(this.data$=this.http.get(`${this.apiUrl}/?search=${t}&page=1`).pipe(j({bufferSize:2,refCount:!0,windowTime:1e4}),$(()=>this.#e.set(10))),this.cacheTimer$=R(1e4).subscribe(()=>this.clearObservable())),this.data$}compareSearchValue(t){this.currentSearch!==t&&(this.clearObservable(),this.cacheTimer$&&this.cacheTimer$.unsubscribe(),this.currentSearch=t)}clearObservable(){this.#e.set(0),this.data$=void 0}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var ue=()=>[ie];function de(e,q){e&1&&s(0,"po-loading-overlay")}function fe(e,q){if(e&1&&s(0,"po-info",2)(1,"po-info",3)(2,"po-info",4)(3,"po-info",5),e&2){let t=O(2);l("p-value",t.people.name),p(),l("p-value",t.people.gender),p(),l("p-value",t.people.height),p(),l("p-value",t.people.mass)}}function he(e,q){if(e&1&&u(0,fe,4,4),e&2){let t=O();h(t.people?0:-1)}}var se=(()=>{class e{constructor(){this.isLoading=!1,this.name=S("Luke"),this.modal=H.required(C),this.peopleStarWarsService=r(f),this.poNotification=r(d)}onClickSearch(){this.isLoading=!0,this.peopleStarWarsService.findPeopleWithCache(this.name()).pipe(g(()=>this.isLoading=!1)).subscribe({next:t=>this.onHandleResponse(t),error:()=>this.poNotification.success("Falha ao tentar buscar pessoa")})}onHandleResponse(t){if(t.results.length){this.people=t.results[0];let o={message:this.people?.name||"",actionLabel:"Detalhes",supportMessage:"Pesquisa conclu\xEDda com sucesso",action:()=>this.modal().open()};this.poNotification.success(o)}else this.poNotification.warning("Nenhum resultado foi encontrado para a pesquisa")}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=m({type:e,selectors:[["app-component-b"]],viewQuery:function(o,i){o&1&&Q(i.modal,C,5),o&2&&U()},inputs:{name:[1,"name"]},outputs:{name:"nameChange"},decls:8,vars:4,consts:[["name","name","p-label","Nome","p-placeholder","Ex: Luke","p-help","Informe o nome de um personagem do Star Wars","p-required","","p-clean","",3,"ngModelChange","ngModel","p-no-autocomplete"],["p-label","Pesquisar","p-kind","primary",3,"p-click"],["p-label","Nome",3,"p-value"],["p-label","Genero",3,"p-value"],["p-label","Peso (massa)",3,"p-value"],["p-label","Altura",3,"p-value"]],template:function(o,i){o&1&&(n(0,"form")(1,"po-input",0),P("ngModelChange",function(c){return b(i.name,c)||(i.name=c),c}),a(),n(2,"po-button",1),y("p-click",function(){return i.onClickSearch()}),a()(),u(3,de,1,0,"po-loading-overlay"),n(4,"po-modal"),u(5,he,1,1),V(6,5,ue),a()),o&2&&(p(),_("ngModel",i.name),l("p-no-autocomplete",!0),p(2),h(i.isLoading?3:-1),p(3),G(!i.modal().isHidden))},dependencies:[F,D,E,B,k,w,oe,C,x,W,M,T,N,L,ne],encapsulation:2})}}return e})();function Ce(e,q){e&1&&s(0,"po-loading-overlay")}var me=(()=>{class e{constructor(){this.name=S("Luke"),this.isLoading=!1,this.peopleStarWarsService=r(f),this.poNotification=r(d)}onClickSearch(){this.isLoading=!0,this.peopleStarWarsService.findPeopleWithCache(this.name()).pipe(g(()=>this.isLoading=!1)).subscribe({next:()=>this.poNotification.success("Sucesso"),error:()=>this.poNotification.success("Falha ao tentar buscar pessoa")})}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=m({type:e,selectors:[["app-component-a"]],inputs:{name:[1,"name"]},outputs:{name:"nameChange"},decls:4,vars:3,consts:[["name","name","p-label","Nome","p-placeholder","Ex: Luke","p-help","Informe o nome de um personagem do Star Wars","p-required","","p-clean","",3,"ngModelChange","ngModel","p-no-autocomplete"],["p-label","Pesquisar","p-kind","primary",3,"p-click"]],template:function(o,i){o&1&&(n(0,"form")(1,"po-input",0),P("ngModelChange",function(c){return b(i.name,c)||(i.name=c),c}),a(),n(2,"po-button",1),y("p-click",function(){return i.onClickSearch()}),a()(),u(3,Ce,1,0,"po-loading-overlay")),o&2&&(p(),_("ngModel",i.name),l("p-no-autocomplete",!0),p(2),h(i.isLoading?3:-1))},dependencies:[F,D,E,B,k,w,x,W,M,T,N,L],encapsulation:2})}}return e})();var le=(()=>{class e{constructor(){this.timeLeft=v(0),this.peopleStarWarsService=r(f),this.notification=r(d),this.timer=X(()=>this.peopleStarWarsService.timer()),Y(()=>{this.onTimerChange(this.timer())})}onTimerChange(t){this.timeLeft.set(this.timer()),t>0?this.startTimer():this.stopTimer()}startTimer(){this.notification.information("O cache foi iniciado"),this.interval=setInterval(()=>{this.timeLeft()>0?this.timeLeft.set(this.timeLeft()-1):(this.notification.information("O cache expirou"),this.stopTimer())},1e3)}stopTimer(){clearInterval(this.interval),this.resetTimer()}resetTimer(){this.timeLeft.set(0)}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=m({type:e,selectors:[["app-timer"]],decls:2,vars:1,consts:[[1,"po-font-text-large-bold"]],template:function(o,i){o&1&&(n(0,"p",0),J(1),a()),o&2&&(p(),K("Tempo restante para a pr\xF3xima requisi\xE7\xE3o: ",i.timeLeft()," segundos"))},encapsulation:2,changeDetection:0})}}return e})();var Ge=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=m({type:e,selectors:[["app-replay"]],decls:8,vars:0,consts:[["p-title","ShareReplay","p-subtitle","Exemplo de uso para Utiliza\xE7\xE3o de Cache em Requisi\xE7\xF5es"],["p-title","Cache de 5s",1,"po-row"],[1,"po-sm-12","po-md-12","po-lg-12","po-xl-12","po-mb-2"],["p-title","Componente A",1,"po-sm-12","po-md-12","po-lg-6","po-xl-6","po-mb-2"],["p-title","Componente B",1,"po-sm-12","po-md-12","po-lg-6","po-xl-6","po-mb-2"]],template:function(o,i){o&1&&(n(0,"po-page-default",0)(1,"po-container",1)(2,"po-container",2),s(3,"app-timer"),a(),n(4,"po-container",3),s(5,"app-component-a"),a(),n(6,"po-container",4),s(7,"app-component-b"),a()()())},dependencies:[me,se,le,pe,ae,te,ee],encapsulation:2})}}return e})();export{Ge as ReplayComponent};
