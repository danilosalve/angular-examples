import{A as k,B as E,C as x,D as B,Da as ie,E as C,F as Y,Fa as ne,P as u,aa as Z,ba as ee,j as _,k as T,la as F,m as L,o as N,p as W,sa as D,ua as te,va as oe,w}from"./chunk-PJGXJYGO.js";import"./chunk-YQH3U43A.js";import{$ as j,Ac as U,B as O,Cb as f,Cc as b,Dc as P,Ec as M,Ja as v,Q as g,Ub as l,Vd as X,W as R,_b as h,bd as J,da as $,dc as n,ec as a,ed as K,fc as s,ib as p,ja as r,lc as y,mc as V,rb as z,sb as S,vc as G,wb as m,wc as H,yc as Q}from"./chunk-EQ2ZZIGX.js";import"./chunk-4CLCTAJ7.js";var d=(()=>{class e{constructor(){this.http=r(X),this.apiUrl="https://swapi.py4e.com/api/people",this.currentSearch="",this.#e=v(0)}#e;get timer(){return this.#e}findPeopleWithCache(t){return this.compareSearchValue(t),this.data$||(this.data$=this.http.get(`${this.apiUrl}/?search=${t}&page=1`).pipe(R({bufferSize:2,refCount:!0,windowTime:1e4}),j(()=>this.#e.set(10))),this.cacheTimer$=O(1e4).subscribe(()=>this.clearObservable())),this.data$}compareSearchValue(t){this.currentSearch!==t&&(this.clearObservable(),this.cacheTimer$&&this.cacheTimer$.unsubscribe(),this.currentSearch=t)}clearObservable(){this.#e.set(0),this.data$=void 0}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function le(e,A){e&1&&s(0,"po-loading-overlay")}function ce(e,A){if(e&1&&s(0,"po-info",2)(1,"po-info",3)(2,"po-info",4)(3,"po-info",5),e&2){let t=V();l("p-value",t.people.name),p(),l("p-value",t.people.gender),p(),l("p-value",t.people.height),p(),l("p-value",t.people.mass)}}var pe=(()=>{class e{constructor(){this.isLoading=!1,this.name=S("Luke"),this.modal=z.required(C),this.peopleStarWarsService=r(d),this.poNotification=r(u)}onClickSearch(){this.isLoading=!0,this.peopleStarWarsService.findPeopleWithCache(this.name()).pipe(g(()=>this.isLoading=!1)).subscribe({next:t=>this.onHandleResponse(t),error:()=>this.poNotification.success("Falha ao tentar buscar pessoa")})}onHandleResponse(t){if(t.results.length){this.people=t.results[0];let o={message:this.people?.name||"",actionLabel:"Detalhes",supportMessage:"Pesquisa conclu\xEDda com sucesso",action:()=>this.modal().open()};this.poNotification.success(o)}else this.poNotification.warning("Nenhum resultado foi encontrado para a pesquisa")}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=m({type:e,selectors:[["app-component-b"]],viewQuery:function(o,i){o&1&&G(i.modal,C,5),o&2&&H()},inputs:{name:[1,"name"]},outputs:{name:"nameChange"},decls:6,vars:4,consts:[["name","name","p-label","Nome","p-placeholder","Ex: Luke","p-help","Informe o nome de um personagem do Star Wars","p-required","","p-clean","",3,"ngModelChange","ngModel","p-no-autocomplete"],["p-label","Pesquisar","p-kind","primary",3,"p-click"],["p-label","Nome",3,"p-value"],["p-label","Genero",3,"p-value"],["p-label","Peso (massa)",3,"p-value"],["p-label","Altura",3,"p-value"]],template:function(o,i){o&1&&(n(0,"form")(1,"po-input",0),M("ngModelChange",function(c){return P(i.name,c)||(i.name=c),c}),a(),n(2,"po-button",1),y("p-click",function(){return i.onClickSearch()}),a()(),f(3,le,1,0,"po-loading-overlay"),n(4,"po-modal"),f(5,ce,4,4),a()),o&2&&(p(),b("ngModel",i.name),l("p-no-autocomplete",!0),p(2),h(i.isLoading?3:-1),p(2),h(i.people?5:-1))},dependencies:[D,F,B,x,E,k,Y,C,w,W,_,T,N,L,oe,te],encapsulation:2})}}return e})();function ue(e,A){e&1&&s(0,"po-loading-overlay")}var re=(()=>{class e{constructor(){this.name=S("Luke"),this.isLoading=!1,this.peopleStarWarsService=r(d),this.poNotification=r(u)}onClickSearch(){this.isLoading=!0,this.peopleStarWarsService.findPeopleWithCache(this.name()).pipe(g(()=>this.isLoading=!1)).subscribe({next:()=>this.poNotification.success("Sucesso"),error:()=>this.poNotification.success("Falha ao tentar buscar pessoa")})}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=m({type:e,selectors:[["app-component-a"]],inputs:{name:[1,"name"]},outputs:{name:"nameChange"},decls:4,vars:3,consts:[["name","name","p-label","Nome","p-placeholder","Ex: Luke","p-help","Informe o nome de um personagem do Star Wars","p-required","","p-clean","",3,"ngModelChange","ngModel","p-no-autocomplete"],["p-label","Pesquisar","p-kind","primary",3,"p-click"]],template:function(o,i){o&1&&(n(0,"form")(1,"po-input",0),M("ngModelChange",function(c){return P(i.name,c)||(i.name=c),c}),a(),n(2,"po-button",1),y("p-click",function(){return i.onClickSearch()}),a()(),f(3,ue,1,0,"po-loading-overlay")),o&2&&(p(),b("ngModel",i.name),l("p-no-autocomplete",!0),p(2),h(i.isLoading?3:-1))},dependencies:[D,F,B,x,E,k,w,W,_,T,N,L],encapsulation:2})}}return e})();var se=(()=>{class e{constructor(){this.timeLeft=v(0),this.peopleStarWarsService=r(d),this.notification=r(u),this.timer=J(()=>this.peopleStarWarsService.timer()),K(()=>{this.onTimerChange(this.timer())})}onTimerChange(t){this.timeLeft.set(this.timer()),t>0?this.startTimer():this.stopTimer()}startTimer(){this.notification.information("O cache foi iniciado"),this.interval=setInterval(()=>{this.timeLeft()>0?this.timeLeft.set(this.timeLeft()-1):(this.notification.information("O cache expirou"),this.stopTimer())},1e3)}stopTimer(){clearInterval(this.interval),this.resetTimer()}resetTimer(){this.timeLeft.set(0)}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=m({type:e,selectors:[["app-timer"]],decls:2,vars:1,consts:[[1,"po-font-text-large-bold"]],template:function(o,i){o&1&&(n(0,"p",0),Q(1),a()),o&2&&(p(),U("Tempo restante para a pr\xF3xima requisi\xE7\xE3o: ",i.timeLeft()," segundos"))},encapsulation:2,changeDetection:0})}}return e})();var $e=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=m({type:e,selectors:[["app-replay"]],decls:8,vars:0,consts:[["p-title","ShareReplay","p-subtitle","Exemplo de uso para Utiliza\xE7\xE3o de Cache em Requisi\xE7\xF5es"],["p-title","Cache de 5s",1,"po-row"],[1,"po-sm-12","po-md-12","po-lg-12","po-xl-12","po-mb-2"],["p-title","Componente A",1,"po-sm-12","po-md-12","po-lg-6","po-xl-6","po-mb-2"],["p-title","Componente B",1,"po-sm-12","po-md-12","po-lg-6","po-xl-6","po-mb-2"]],template:function(o,i){o&1&&(n(0,"po-page-default",0)(1,"po-container",1)(2,"po-container",2),s(3,"app-timer"),a(),n(4,"po-container",3),s(5,"app-component-a"),a(),n(6,"po-container",4),s(7,"app-component-b"),a()()())},dependencies:[re,pe,se,ne,ie,ee,Z],encapsulation:2})}}return e})();export{$e as ReplayComponent};
