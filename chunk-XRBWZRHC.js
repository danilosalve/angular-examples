import{$ as d,Ha as a,ia as y,id as m,ld as g,qa as l,ya as b}from"./chunk-WCLJ7DBJ.js";import{a as f,b as v}from"./chunk-JKOY2XUY.js";function p(o,e){let r=!e?.manualCleanup;r&&!e?.injector&&l(p);let u=r?e?.injector?.get(b)??y(b):null,i=h(e?.equal),n;e?.requireSync?n=a({kind:0},{equal:i}):n=a({kind:1,value:e?.initialValue},{equal:i});let c,s=o.subscribe({next:t=>n.set({kind:1,value:t}),error:t=>{if(e?.rejectErrors)throw t;n.set({kind:2,error:t})},complete:()=>{c?.()}});if(e?.requireSync&&n().kind===0)throw new d(601,!1);return c=u?.onDestroy(s.unsubscribe.bind(s)),m(()=>{let t=n();switch(t.kind){case 1:return t.value;case 2:throw t.error;case 0:throw new d(601,!1)}},{equal:e?.equal})}function h(o=Object.is){return(e,r)=>e.kind===1&&r.kind===1&&o(e.value,r.value)}function w(o){return o?.injector||l(w),g(v(f({},o),{loader:void 0,stream:e=>{let r,u=()=>r.unsubscribe();e.abortSignal.addEventListener("abort",u);let i=a({value:void 0}),n,c=new Promise(t=>n=t);function s(t){i.set(t),n?.(i),n=void 0}return r=o.loader(e).subscribe({next:t=>s({value:t}),error:t=>{s({error:t}),e.abortSignal.removeEventListener("abort",u)},complete:()=>{n&&s({error:new Error("Resource completed before producing a value")}),e.abortSignal.removeEventListener("abort",u)}}),c}}))}export{p as a,w as b};
