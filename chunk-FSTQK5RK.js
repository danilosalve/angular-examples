import{a as U}from"./chunk-E4BDGP6P.js";import{A as x,B as N,C as $,Da as B,E as z,Ea as F,Fa as J,Ua as R,Va as A}from"./chunk-HCPK7XEO.js";import{t as T}from"./chunk-MDUUVM26.js";import{$b as P,Y as E,_b as u,a as g,ac as j,bc as D,c as w,da as W,db as h,e as y,h as d,i as I,ia as C,k as b,vb as O,xa as M}from"./chunk-QL522RBE.js";import{a as S}from"./chunk-RTRJ3KFH.js";var K={url:"",deserializer:r=>JSON.parse(r.data),serializer:r=>JSON.stringify(r)},L="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",k=class r extends I{constructor(e,c){if(super(),this._socket=null,e instanceof y)this.destination=c,this.source=e;else{let o=this._config=Object.assign({},K);if(this._output=new d,typeof e=="string")o.url=e;else for(let n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);if(!o.WebSocketCtor&&WebSocket)o.WebSocketCtor=WebSocket;else if(!o.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new b}}lift(e){let c=new r(this._config,this.destination);return c.operator=e,c.source=this,c}_resetState(){this._socket=null,this.source||(this.destination=new b),this._output=new d}multiplex(e,c,o){let n=this;return new y(t=>{try{n.next(e())}catch(a){t.error(a)}let i=n.subscribe({next:a=>{try{o(a)&&t.next(a)}catch(s){t.error(s)}},error:a=>t.error(a),complete:()=>t.complete()});return()=>{try{n.next(c())}catch(a){t.error(a)}i.unsubscribe()}})}_connectSocket(){let{WebSocketCtor:e,protocol:c,url:o,binaryType:n}=this._config,t=this._output,i=null;try{i=c?new e(o,c):new e(o),this._socket=i,n&&(this._socket.binaryType=n)}catch(s){t.error(s);return}let a=new g(()=>{this._socket=null,i&&i.readyState===1&&i.close()});i.onopen=s=>{let{_socket:p}=this;if(!p){i.close(),this._resetState();return}let{openObserver:m}=this._config;m&&m.next(s);let _=this.destination;this.destination=w.create(l=>{if(i.readyState===1)try{let{serializer:f}=this._config;i.send(f(l))}catch(f){this.destination.error(f)}},l=>{let{closingObserver:f}=this._config;f&&f.next(void 0),l&&l.code?i.close(l.code,l.reason):t.error(new TypeError(L)),this._resetState()},()=>{let{closingObserver:l}=this._config;l&&l.next(void 0),i.close(),this._resetState()}),_&&_ instanceof b&&a.add(_.subscribe(this.destination))},i.onerror=s=>{this._resetState(),t.error(s)},i.onclose=s=>{i===this._socket&&this._resetState();let{closeObserver:p}=this._config;p&&p.next(s),s.wasClean?t.complete():t.error(s)},i.onmessage=s=>{try{let{deserializer:p}=this._config;t.next(p(s))}catch(p){t.error(p)}}}_subscribe(e){let{source:c}=this;return c?c.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(()=>{let{_socket:o}=this;this._output.observers.length===0&&(o&&(o.readyState===1||o.readyState===0)&&o.close(),this._resetState())}),e)}unsubscribe(){let{_socket:e}=this;e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState(),super.unsubscribe()}};function v(r){return new k(r)}var q=(()=>{let e=class e{constructor(){let o="wss://wss.coincap.io/prices?assets=ethereum,bitcoin,dogecoin,maker,solana";this.sockets$=v(o)}getStockPrices(){return this.sockets$.asObservable()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var me=(()=>{let e=class e{constructor(){this.orientation=B.Horizontal,this.stocks=M(null),this.unsub$=new d,this.coinsService=C(q)}ngOnInit(){this.coinsService.getStockPrices().pipe(E(this.unsub$)).subscribe(o=>this.stocks.update(n=>S(S({},n),o)))}ngOnDestroy(){this.unsub$.next(!0),this.unsub$.complete()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=O({type:e,selectors:[["app-coins"]],decls:8,vars:11,consts:[["target",""],["appIsDeveloperMode","","resourceName","'Informa\xE7\xF5es de Cripto Moedas'","p-title","Cripto Moedas",3,"p-height"],["p-label","Bitcoin",3,"p-value","p-orientation"],["p-label","DogeCoin",3,"p-value","p-orientation"],["p-label","Ethereum",3,"p-value","p-orientation"],["p-label","Maker",3,"p-value","p-orientation"],["p-label","Solana",3,"p-value","p-orientation"],["p-icon","an an-question","p-tooltip","Exemplo de uso de um WebSocket",1,"po-clickable"]],template:function(n,t){if(n&1&&(P(0,"po-widget",1),D(1,"po-info",2)(2,"po-info",3)(3,"po-info",4)(4,"po-info",5)(5,"po-info",6)(6,"po-icon",7,0),j()),n&2){let i,a,s,p,m;u("p-height",220),h(),u("p-value",((i=t.stocks())==null?null:i.bitcoin)??0)("p-orientation",t.orientation),h(),u("p-value",((a=t.stocks())==null?null:a.dogecoin)??0)("p-orientation",t.orientation),h(),u("p-value",((s=t.stocks())==null?null:s.ethereum)??0)("p-orientation",t.orientation),h(),u("p-value",((p=t.stocks())==null?null:p.maker)??0)("p-orientation",t.orientation),h(),u("p-value",((m=t.stocks())==null?null:m.solana)??0)("p-orientation",t.orientation)}},dependencies:[T,A,R,J,F,N,x,z,$,U],encapsulation:2});let r=e;return r})();export{me as CoinsComponent};
