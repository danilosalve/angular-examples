import{a as te}from"./chunk-W76JX73M.js";import{a as ie}from"./chunk-PMAZFM5Y.js";import"./chunk-MJJCZ32K.js";import{Ca as Q,Ga as X,Ha as Y,N as O,P as z,Pa as Z,Qa as ee,ca as U,i as r,k as T,l as j,oa as W,q as G,s as k,ua as H,v as V,va as J,w as B,xa as K,y as $}from"./chunk-HCPK7XEO.js";import{C as L,E as h,l as R,t as q}from"./chunk-MDUUVM26.js";import{$b as p,Gc as P,Hc as A,Ic as E,L as F,P as C,Ub as c,Vb as u,Vc as w,Wc as M,_ as y,_b as s,ac as g,bc as d,da as S,db as l,ia as n,ic as N,nc as I,oa as _,oc as f,p as b,pa as x,t as v,vb as D}from"./chunk-QL522RBE.js";import"./chunk-RTRJ3KFH.js";var oe=(()=>{let o=class o{constructor(){this.filmsService=n(te),this.notification=n(W),this.router=n(h),this.fb=n(B),this.notificationService=n(ie),this.genreOptions=[{label:"Anima\xE7\xE3o",value:"Anima\xE7\xE3o"},{label:"A\xE7\xE3o",value:"A\xE7\xE3o"},{label:"Aventura",value:"Aventura"},{label:"Crime",value:"Crime"},{label:"Com\xE9dia",value:"Com\xE9dia"},{label:"Com\xE9dia romantica",value:"Com\xE9dia romantica"},{label:"Drama",value:"Drama"},{label:"Fantasia",value:"Fantasia"},{label:"Fic\xE7\xE3o cient\xEDfica",value:"Fic\xE7\xE3o cient\xEDfica"},{label:"Romance",value:"Romance"},{label:"Suspense",value:"Suspense"},{label:"Terror",value:"Terror"}],this.getNewFilm={id:0,name:"",duration:"",genre:"",image:"assets/img/not-found-image.jpg",releaseDate:new Date}}getForm(e,i){return i?b(this.fb.group({id:[e.id],name:[e.name,r.required],duration:[e.duration,r.compose([r.required,r.pattern("[0-9]{2}:[0-9]{2}")])],genre:[this.transformGenre(e.genre),r.required],releaseDate:[this.transformReleaseDate(e.releaseDate)],image:[e.image]})):this.getNextId().pipe(v(a=>this.fb.group({id:[a],name:[e.name,r.required],duration:[e.duration,r.compose([r.required,r.pattern("[0-9]{2}:[0-9]{2}")])],genre:[e.genre,r.required],releaseDate:[e.releaseDate],image:[e.image]})))}onSubmit(e,i){return i.genre=i.genre?i.genre.toString():"",i.image=i.image??"",(e?this.filmsService.put(i,i.id):this.filmsService.create(i)).pipe(y({next:()=>this.onSendSuccessfully(e),error:()=>this.onSendError(e)}))}getNextId(){return this.filmsService.getAllFilms().pipe(v(e=>!e||e.length===0?1:Math.max(...e.map(a=>a.id))+1))}onSendSuccessfully(e){e||this.notificationService.sendNotification("Um novo filme foi adicionado a lista"),this.notification.success(`Filme ${e?"alterado":"inclu\xEDdo"} com sucesso!`),this.router.navigate(["/sample/in-memory/films"])}onSendError(e){this.notification.error(`N\xE3o foi poss\xEDvel salvar a ${e?"altera\xE7\xE3o":"inclus\xE3o"}. Contate o Administrador do sistema`)}transformGenre(e){return Array.isArray(e)?e:e.split(",").map(i=>i.trim())}transformReleaseDate(e){return new Intl.DateTimeFormat("en-CA").format(new Date(e))}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})();function ne(t,o){if(t&1&&d(0,"po-image",3),t&2){let m=f(2);s("p-src",m.image)("p-height",300)}}function me(t,o){t&1&&d(0,"po-image",4),t&2&&s("p-height",300)}function le(t,o){if(t&1){let m=N();p(0,"form",1)(1,"div",2),c(2,ne,1,2,"po-image",3)(3,me,1,1,"po-image",4),p(4,"po-url",5),E("ngModelChange",function(i){_(m);let a=f();return A(a.image,i)||(a.image=i),x(i)}),g()(),p(5,"div",6),d(6,"po-input",7)(7,"po-multiselect",8)(8,"po-input",9)(9,"po-datepicker",10),g()()}if(t&2){let m=f();s("formGroup",m.form),l(2),u(m.image?2:3),l(2),P("ngModel",m.image),l(2),s("p-no-autocomplete",!0),l(),s("p-options",m.options)("p-required",!0),l(),s("p-no-autocomplete",!0)("p-pattern","[0-9]{2}:[0-9]{2}")("p-maxlength",5),l(),s("p-max-date",m.maxDate)}}function se(t,o){t&1&&d(0,"po-loading-overlay")}var Ee=(()=>{let o=class o{constructor(){this.activatedRoute=n(L),this.router=n(h),this.isEdit=!1,this.isSubmit=!1,this.filmsFormService=n(oe),this.film=this.filmsFormService.getNewFilm,this.breadcrumb={items:[{label:"Home",link:"/"},{label:"Filmes",link:"/sample/in-memory/films"},{label:"Novo Filme"}]},this.image="assets/img/not-found-image.jpg",this.isLoading=!1,this.maxDate=new Date,this.options=this.filmsFormService.genreOptions,this.title="Novo Filme"}ngOnInit(){this.onInitPage(),this.onInitForm()}getCurrentAction(){return this.activatedRoute.snapshot.url[0].path==="edit"}hasChanges(){return this.form.dirty&&!this.isSubmit}loadFilmByRouter(){this.activatedRoute.data.subscribe(({film:e})=>this.film=e)}onCancel(){this.router.navigate(["/sample/in-memory/films"])}onInitForm(){this.isLoading=!this.isEdit,this.form$=this.filmsFormService.getForm(this.film,this.isEdit),this.form$.pipe(C(()=>this.isLoading=!1)).subscribe(e=>this.form=e),this.image=this.film.image}onInitPage(){this.isEdit=this.getCurrentAction(),this.isEdit&&(this.breadcrumb.items[2].label="Editar Filme",this.title="Editar Filme",this.loadFilmByRouter())}onSubmit(){let e=this.form.getRawValue();this.isLoading=!0,this.filmsFormService.onSubmit(this.isEdit,e).pipe(C(()=>this.isLoading=!1),F(1)).subscribe({next:()=>this.isSubmit=!0})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=D({type:o,selectors:[["app-form"]],decls:4,vars:7,consts:[[3,"p-save","p-cancel","p-title","p-breadcrumb","p-disable-submit"],[3,"formGroup"],[1,"po-md-5","po-lg-5"],["p-loading","lazy","p-alt","Capa do filme",3,"p-src","p-height"],["p-src","assets/img/not-found-image.jpg","p-loading","lazy","p-alt","Capa do filme",3,"p-height"],["formControlName","image","p-label","URL da Imagem","p-placeholder","https://imagem.com.br/imagem.jpg","p-clean","",3,"ngModelChange","ngModel"],[1,"po-md-7","po-lg-7"],["formControlName","name","p-label","Nome","p-placeholder","Informe o titulo do Filme","p-clean","","p-required","",3,"p-no-autocomplete"],["formControlName","genre","p-label","G\xEAnero","p-placeholder","Selecione o g\xEAnero do Filme",3,"p-options","p-required"],["formControlName","duration","p-label","Dura\xE7\xE3o","p-placeholder","00:00","p-clean","","p-required","",3,"p-no-autocomplete","p-pattern","p-maxlength"],["formControlName","releaseDate","p-label","Data de Lan\xE7amento","p-format","dd/mm/yyyy","p-placeholder","01/01/1970","p-required","","p-clean","",3,"p-max-date"]],template:function(i,a){i&1&&(p(0,"po-page-edit",0),I("p-save",function(){return a.onSubmit()})("p-cancel",function(){return a.onCancel()}),c(1,le,10,10,"form",1),w(2,"async"),c(3,se,1,0,"po-loading-overlay"),g()),i&2&&(s("p-title",a.title)("p-breadcrumb",a.breadcrumb)("p-disable-submit",a.isLoading),l(),u(M(2,5,a.form$)?1:-1),l(2),u(a.isLoading?3:-1))},dependencies:[z,O,ee,Z,Q,U,H,J,K,$,G,T,j,k,V,Y,X,q,R],encapsulation:2});let t=o;return t})();export{Ee as FormComponent};
