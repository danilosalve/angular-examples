import{a as U}from"./chunk-SOKWRCJM.js";import{A as x,B as $,Ba as F,C as z,Ca as N,Da as J,E as B,Ra as R,Sa as A}from"./chunk-3H4NJUFE.js";import{t as D}from"./chunk-SBPM3P26.js";import{Ha as M,Ub as u,Y as I,a as g,c as w,ca as E,e as S,ec as P,fc as j,gc as T,h,i as C,ia as W,jb as d,k as m,xb as O}from"./chunk-ROBB4PN5.js";import{a as k}from"./chunk-JKOY2XUY.js";var K={url:"",deserializer:c=>JSON.parse(c.data),serializer:c=>JSON.stringify(c)},L="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",b=class c extends C{constructor(e,n){if(super(),this._socket=null,e instanceof S)this.destination=n,this.source=e;else{let t=this._config=Object.assign({},K);if(this._output=new h,typeof e=="string")t.url=e;else for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);if(!t.WebSocketCtor&&WebSocket)t.WebSocketCtor=WebSocket;else if(!t.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new m}}lift(e){let n=new c(this._config,this.destination);return n.operator=e,n.source=this,n}_resetState(){this._socket=null,this.source||(this.destination=new m),this._output=new h}multiplex(e,n,t){let i=this;return new S(s=>{try{i.next(e())}catch(a){s.error(a)}let o=i.subscribe({next:a=>{try{t(a)&&s.next(a)}catch(r){s.error(r)}},error:a=>s.error(a),complete:()=>s.complete()});return()=>{try{i.next(n())}catch(a){s.error(a)}o.unsubscribe()}})}_connectSocket(){let{WebSocketCtor:e,protocol:n,url:t,binaryType:i}=this._config,s=this._output,o=null;try{o=n?new e(t,n):new e(t),this._socket=o,i&&(this._socket.binaryType=i)}catch(r){s.error(r);return}let a=new g(()=>{this._socket=null,o&&o.readyState===1&&o.close()});o.onopen=r=>{let{_socket:p}=this;if(!p){o.close(),this._resetState();return}let{openObserver:v}=this._config;v&&v.next(r);let _=this.destination;this.destination=w.create(l=>{if(o.readyState===1)try{let{serializer:f}=this._config;o.send(f(l))}catch(f){this.destination.error(f)}},l=>{let{closingObserver:f}=this._config;f&&f.next(void 0),l&&l.code?o.close(l.code,l.reason):s.error(new TypeError(L)),this._resetState()},()=>{let{closingObserver:l}=this._config;l&&l.next(void 0),o.close(),this._resetState()}),_&&_ instanceof m&&a.add(_.subscribe(this.destination))},o.onerror=r=>{this._resetState(),s.error(r)},o.onclose=r=>{o===this._socket&&this._resetState();let{closeObserver:p}=this._config;p&&p.next(r),r.wasClean?s.complete():s.error(r)},o.onmessage=r=>{try{let{deserializer:p}=this._config;s.next(p(r))}catch(p){s.error(p)}}}_subscribe(e){let{source:n}=this;return n?n.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(()=>{let{_socket:t}=this;this._output.observers.length===0&&(t&&(t.readyState===1||t.readyState===0)&&t.close(),this._resetState())}),e)}unsubscribe(){let{_socket:e}=this;e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState(),super.unsubscribe()}};function y(c){return new b(c)}var q=(()=>{class c{constructor(){let n="wss://wss.coincap.io/prices?assets=ethereum,bitcoin,dogecoin,maker,solana";this.sockets$=y(n)}getStockPrices(){return this.sockets$.asObservable()}static{this.\u0275fac=function(t){return new(t||c)}}static{this.\u0275prov=E({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})();var he=(()=>{class c{constructor(){this.orientation=F.Horizontal,this.stocks=M(null),this.unsub$=new h,this.coinsService=W(q)}ngOnInit(){this.coinsService.getStockPrices().pipe(I(this.unsub$)).subscribe(n=>this.stocks.update(t=>k(k({},t),n)))}ngOnDestroy(){this.unsub$.next(!0),this.unsub$.complete()}static{this.\u0275fac=function(t){return new(t||c)}}static{this.\u0275cmp=O({type:c,selectors:[["app-coins"]],decls:8,vars:11,consts:[["target",""],["appIsDeveloperMode","","resourceName","'Informa\xE7\xF5es de Cripto Moedas'","p-title","Cripto Moedas",3,"p-height"],["p-label","Bitcoin",3,"p-value","p-orientation"],["p-label","DogeCoin",3,"p-value","p-orientation"],["p-label","Ethereum",3,"p-value","p-orientation"],["p-label","Maker",3,"p-value","p-orientation"],["p-label","Solana",3,"p-value","p-orientation"],["p-icon","an an-question","p-tooltip","Exemplo de uso de um WebSocket",1,"po-clickable"]],template:function(t,i){if(t&1&&(P(0,"po-widget",1),T(1,"po-info",2)(2,"po-info",3)(3,"po-info",4)(4,"po-info",5)(5,"po-info",6)(6,"po-icon",7,0),j()),t&2){let s,o,a,r,p;u("p-height",220),d(),u("p-value",(s=(s=i.stocks())==null?null:s.bitcoin)!==null&&s!==void 0?s:0)("p-orientation",i.orientation),d(),u("p-value",(o=(o=i.stocks())==null?null:o.dogecoin)!==null&&o!==void 0?o:0)("p-orientation",i.orientation),d(),u("p-value",(a=(a=i.stocks())==null?null:a.ethereum)!==null&&a!==void 0?a:0)("p-orientation",i.orientation),d(),u("p-value",(r=(r=i.stocks())==null?null:r.maker)!==null&&r!==void 0?r:0)("p-orientation",i.orientation),d(),u("p-value",(p=(p=i.stocks())==null?null:p.solana)!==null&&p!==void 0?p:0)("p-orientation",i.orientation)}},dependencies:[D,A,R,J,N,$,x,B,z,U],encapsulation:2})}}return c})();export{he as CoinsComponent};
