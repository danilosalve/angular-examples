import{$ as se,Ca as A,Ea as le,Fa as ce,N as k,Na as de,O as F,P as B,Q as I,Qa as ue,_ as re,da as v,ea as me,k as L,l as D,n as x,oa as f,p as W,q as w,ua as q,x as E}from"./chunk-HCPK7XEO.js";import"./chunk-MDUUVM26.js";import{$b as s,B as H,Bb as U,Cc as te,Ec as oe,Fd as pe,Gc as P,Hc as _,Ic as N,Mb as J,Nb as K,P as y,Ub as g,V,Vb as C,_ as G,_b as d,ac as m,bc as l,cc as X,da as Q,db as p,dc as Y,dd as ie,ed as ne,ia as r,ld as ae,md as T,nc as M,oc as R,vb as c,vc as Z,wc as ee,xa as b}from"./chunk-QL522RBE.js";import{g as S,h as $,i as z}from"./chunk-RTRJ3KFH.js";var h=(()=>{var e;let a=class a{constructor(){$(this,e);this.http=r(pe),this.apiUrl="https://swapi.py4e.com/api/people",this.currentSearch="",z(this,e,b(0))}get timer(){return S(this,e)}findPeopleWithCache(t){return this.compareSearchValue(t),this.data$||(this.data$=this.http.get(`${this.apiUrl}/?search=${t}&page=1`).pipe(V({bufferSize:2,refCount:!0,windowTime:1e4}),G(()=>S(this,e).set(10))),this.cacheTimer$=H(1e4).subscribe(()=>this.clearObservable())),this.data$}compareSearchValue(t){this.currentSearch!==t&&(this.clearObservable(),this.cacheTimer$&&this.cacheTimer$.unsubscribe(),this.currentSearch=t)}clearObservable(){S(this,e).set(0),this.data$=void 0}};e=new WeakMap,a.\u0275fac=function(i){return new(i||a)},a.\u0275prov=Q({token:a,factory:a.\u0275fac,providedIn:"root"});let o=a;return o})();var Se=()=>[le];function ye(o,e){o&1&&l(0,"po-loading-overlay")}function be(o,e){if(o&1&&l(0,"po-info",2)(1,"po-info",3)(2,"po-info",4)(3,"po-info",5),o&2){let a=R(2);d("p-value",a.people.name),p(),d("p-value",a.people.gender),p(),d("p-value",a.people.height),p(),d("p-value",a.people.mass)}}function Me(o,e){if(o&1&&g(0,be,4,4),o&2){let a=R();C(a.people?0:-1)}}var he=(()=>{let e=class e{constructor(){this.isLoading=!1,this.name=T("Luke"),this.modal=ae.required(v),this.peopleStarWarsService=r(h),this.poNotification=r(f)}onClickSearch(){this.isLoading=!0,this.peopleStarWarsService.findPeopleWithCache(this.name()).pipe(y(()=>this.isLoading=!1)).subscribe({next:n=>this.onHandleResponse(n),error:()=>this.poNotification.success("Falha ao tentar buscar pessoa")})}onHandleResponse(n){if(n.results.length){this.people=n.results[0];let t={message:this.people?.name||"",actionLabel:"Detalhes",supportMessage:"Pesquisa conclu\xEDda com sucesso",action:()=>this.modal().open()};this.poNotification.success(t)}else this.poNotification.warning("Nenhum resultado foi encontrado para a pesquisa")}};e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c({type:e,selectors:[["app-component-b"]],viewQuery:function(t,i){t&1&&Z(i.modal,v,5),t&2&&ee()},inputs:{name:[1,"name"]},outputs:{name:"nameChange"},decls:8,vars:4,consts:[["name","name","p-label","Nome","p-placeholder","Ex: Luke","p-help","Informe o nome de um personagem do Star Wars","p-required","","p-clean","",3,"ngModelChange","ngModel","p-no-autocomplete"],["p-label","Pesquisar","p-kind","primary",3,"p-click"],["p-label","Nome",3,"p-value"],["p-label","Genero",3,"p-value"],["p-label","Peso (massa)",3,"p-value"],["p-label","Altura",3,"p-value"]],template:function(t,i){t&1&&(s(0,"form")(1,"po-input",0),N("ngModelChange",function(u){return _(i.name,u)||(i.name=u),u}),m(),s(2,"po-button",1),M("p-click",function(){return i.onClickSearch()}),m()(),g(3,ye,1,0,"po-loading-overlay"),s(4,"po-modal"),U(5,Me,1,1),J(6,5,Se),m()),t&2&&(p(),P("ngModel",i.name),d("p-no-autocomplete",!0),p(2),C(i.isLoading?3:-1),p(3),K(!i.modal().isHidden))},dependencies:[A,q,I,F,B,k,me,v,E,w,L,D,W,x,ce],encapsulation:2});let o=e;return o})();function Pe(o,e){o&1&&l(0,"po-loading-overlay")}var ge=(()=>{let e=class e{constructor(){this.name=T("Luke"),this.isLoading=!1,this.peopleStarWarsService=r(h),this.poNotification=r(f)}onClickSearch(){this.isLoading=!0,this.peopleStarWarsService.findPeopleWithCache(this.name()).pipe(y(()=>this.isLoading=!1)).subscribe({next:()=>this.poNotification.success("Sucesso"),error:()=>this.poNotification.success("Falha ao tentar buscar pessoa")})}};e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c({type:e,selectors:[["app-component-a"]],inputs:{name:[1,"name"]},outputs:{name:"nameChange"},decls:4,vars:3,consts:[["name","name","p-label","Nome","p-placeholder","Ex: Luke","p-help","Informe o nome de um personagem do Star Wars","p-required","","p-clean","",3,"ngModelChange","ngModel","p-no-autocomplete"],["p-label","Pesquisar","p-kind","primary",3,"p-click"]],template:function(t,i){t&1&&(s(0,"form")(1,"po-input",0),N("ngModelChange",function(u){return _(i.name,u)||(i.name=u),u}),m(),s(2,"po-button",1),M("p-click",function(){return i.onClickSearch()}),m()(),g(3,Pe,1,0,"po-loading-overlay")),t&2&&(p(),P("ngModel",i.name),d("p-no-autocomplete",!0),p(2),C(i.isLoading?3:-1))},dependencies:[A,q,I,F,B,k,E,w,L,D,W,x],encapsulation:2});let o=e;return o})();var Ce=(()=>{let e=class e{constructor(){this.timeLeft=b(0),this.peopleStarWarsService=r(h),this.notification=r(f),this.timer=ie(()=>this.peopleStarWarsService.timer()),ne(()=>{this.onTimerChange(this.timer())})}onTimerChange(n){this.timeLeft.set(this.timer()),n>0?this.startTimer():this.stopTimer()}startTimer(){this.notification.information("O cache foi iniciado"),this.interval=setInterval(()=>{this.timeLeft()>0?this.timeLeft.set(this.timeLeft()-1):(this.notification.information("O cache expirou"),this.stopTimer())},1e3)}stopTimer(){clearInterval(this.interval),this.resetTimer()}resetTimer(){this.timeLeft.set(0)}};e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c({type:e,selectors:[["app-timer"]],decls:2,vars:1,consts:[[1,"po-font-text-large-bold"]],template:function(t,i){t&1&&(X(0,"p",0),te(1),Y()),t&2&&(p(),oe("Tempo restante para a pr\xF3xima requisi\xE7\xE3o: ",i.timeLeft()," segundos"))},encapsulation:2,changeDetection:0});let o=e;return o})();var et=(()=>{let e=class e{};e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c({type:e,selectors:[["app-replay"]],decls:8,vars:0,consts:[["p-title","ShareReplay","p-subtitle","Exemplo de uso para Utiliza\xE7\xE3o de Cache em Requisi\xE7\xF5es"],["p-title","Cache de 5s",1,"po-row"],[1,"po-sm-12","po-md-12","po-lg-12","po-xl-12","po-mb-2"],["p-title","Componente A",1,"po-sm-12","po-md-12","po-lg-6","po-xl-6","po-mb-2"],["p-title","Componente B",1,"po-sm-12","po-md-12","po-lg-6","po-xl-6","po-mb-2"]],template:function(t,i){t&1&&(s(0,"po-page-default",0)(1,"po-container",1)(2,"po-container",2),l(3,"app-timer"),m(),s(4,"po-container",3),l(5,"app-component-a"),m(),s(6,"po-container",4),l(7,"app-component-b"),m()()())},dependencies:[ge,he,Ce,ue,de,se,re],encapsulation:2});let o=e;return o})();export{et as ReplayComponent};
